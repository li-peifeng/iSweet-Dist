import{a as N,b as se,a$ as U,dP as ie,dQ as oe,k as le,m as c,x as ce,h as e,U as ue,K as W,L as D,H as F,R as de,a0 as ge,a1 as S,a3 as he,S as H,a6 as g,aR as me,ad as fe,a7 as J,J as K,dh as we,au as z,N as be,aJ as Q,al as pe,cl as xe,cW as ke,ai as $e,bK as Ce,bI as _e,aI as ye,av as je,aw as ve,az as Me,_ as P,t as x,dR as Se,l as Pe,aH as Le}from"./index.9e1720f6.js";import{L as Oe,c as m}from"./List.e8f0ad6a.js";import{a as Ie,d as ze}from"./index.48102ec1.js";import Be from"./Password.b687a387.js";import{a as Ae}from"./helper.2aeec8a7.js";import{g as Re}from"./icon.faf3cea3.js";import{x as L,w as qe,b as Ee}from"./solid-contextmenu.99093cb7.js";import"./index.b52ccfe2.js";import"./Layout.c9e32e83.js";import"./SwitchColorMode.054f5229.js";import"./FolderTree.4a7f7c76.js";import"./index.6866d353.js";import"./index.64de6cba.js";function Te(){let n=!1,i=[];return{acquire:()=>new Promise(a=>{n?i.push(a):(n=!0,a())}),release:()=>{i.length>0?i.shift()():n=!1}}}const V=n=>{window.open(n,"_blank")},Ue=n=>{const{show:i}=Ee({id:2}),{isMouseSupported:a}=Ae(),u=()=>Pe.list_item_filename_overflow;return e($e.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return e(z,{class:"list-item viselect-item",get["data-index"](){return n.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:be()}},get cursor(){return a()?"default":"pointer"},"on:click":f=>{n.obj.is_dir?n.jumpCallback():n.url&&V(n.url)},onContextMenu:f=>{i(f,{props:n})},get children(){return[e(z,{class:"name-box",spacing:"$1",get w(){return m[0].w},get children(){return[e(Q,{class:"icon",boxSize:"$6",get color(){return pe()},get as(){return Re(n.obj)},mr:"$1"}),e(g,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:u()==="multi_line"?"unset":"nowrap","overflow-x":u()==="scrollable"?"auto":"hidden",textOverflow:u()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return n.obj.name},get children(){return n.obj.name}})]}}),e(g,{class:"size",get w(){return m[1].w},get textAlign(){return m[1].textAlign},get children(){return xe(n.obj.size)}}),e(g,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return m[2].w},get textAlign(){return m[2].textAlign},get children(){return ke(n.obj.modified)}})]}})}})},O={extract:{icon:Ie,color:"$success9"},copy_link:{icon:ze,color:"$info9"},download:{icon:Le,color:"$primary9"}},We=()=>{const{copy:n}=Ce(),{colorMode:i}=_e();return e(qe,{id:2,animation:"scale",get theme(){return i()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[e(L,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{V(a.url+"&attachment=true")},get children(){return e(I,{name:"download"})}}),e(L,{hidden:({props:a})=>a.obj.is_dir,onClick:({props:a})=>{n(a.url)},get children(){return e(I,{name:"copy_link"})}}),e(L,{hidden:()=>{const a=ye.findIndex(u=>u==="decompress");return!je.can(ve(),a)},onClick:({props:a})=>{Me.emit("extract",JSON.stringify({inner:a.innerPath,pass:a.pass}))},get children(){return e(I,{name:"extract"})}})]}})},I=n=>{const i=N();return e(z,{spacing:"$2",get children(){return[e(Q,{get p(){return O[n.name].p?"$1":void 0},get as(){return O[n.name].icon},boxSize:"$7",get color(){return O[n.name].color}}),e(g,{get children(){return i(`home.toolbar.${n.name}`)}})]}})},tt=()=>{const n=N(),{pathname:i}=se(),[a,u]=U(ie),[f,B]=U(oe),G=le(()=>a()||f());let o="",k="",$="",w=null;const[C,b]=c(""),[X,A]=c(!1),[_,y]=c(!1),[R,Y]=c(""),[l,j]=c([]),[v,Z]=c(),[ee,te]=c(!1),d=Te(),p=r=>{let s={};return r.forEach(t=>{s[t.name]={...t,children:t.children?p(t.children):null}}),s},M=r=>r.code===200?!1:(r.code===202?x(()=>{o!==""&&A(!0),y(!0),b("")}):b(r.message),!0),q=async r=>{if(await d.acquire(),_()&&o==="")return d.release(),[];if(k===""){const t=await u(i(),P(),o);if(M(t))return d.release(),[];if(t.data.content!==null&&(w=p(t.data.content)),k=t.data.raw_url,$=t.data.sign,Y(t.data.comment),t.data.encrypted&&o==="")return x(()=>{y(!0),b("")}),d.release(),[]}if(w===null){const t=await B(i(),P(),o,"/");if(M(t))return d.release(),[];w=p(t.data.content)}let s=w;for(let t=0;t<r.length;t++){if(s[r[t]].children===null){const h=await B(i(),P(),o,"/"+r.slice(0,t+1).join("/"));if(M(h))return d.release(),[];s[r[t]].children=p(h.data.content)}s=s[r[t]].children}return x(()=>{y(!1),A(!1),b("")}),d.release(),Object.values(s)},[re,E]=c([]);ce(()=>{q(l()).then(r=>E(r))});const T=()=>{q(l()).then(r=>E(r))};T();const ne=()=>{let r=re();return v()&&(r=r.sort((s,t)=>(ee()?-1:1)*Se(s[v()],t[v()]))),r},ae=(r,s)=>{x(()=>{Z(r),s!==void 0&&te(s)})};return e(J,{spacing:"$2",w:"$full",get children(){return[e(ue,{pl:"$2",pr:"$2",w:"$full",get children(){return[e(W,{get children(){return e(D,{get currentPage(){return l().length===0},"on:click":()=>j([]),children:"."})}}),e(F,{get each(){return l()},children:(r,s)=>e(W,{get children(){return[e(de,{}),e(D,{get currentPage(){return l().length===s()+1},"on:click":()=>j(l().slice(0,s()+1)),children:r})]}})})]}}),e(ge,{get children(){return[e(S,{get when(){return C()!==""},get children(){return e(he,{get msg(){return C()},disableColor:!0})}}),e(S,{get when(){return _()},get children(){return e(Be,{get title(){return n("home.toolbar.archive.input_password")},password:()=>o,setPassword:r=>o=r,enterCallback:()=>T(),get children(){return e(H,{get when(){return X()},get children(){return e(g,{color:"$danger9",get children(){return n("home.toolbar.archive.incorrect_password")}})}})}})}}),e(S,{get when(){return me(()=>!_(),!0)()&&C()===""},get children(){return e(fe,{get loading(){return G()},get children(){return e(J,{class:"list",w:"$full",spacing:"$1",get children(){return[e(Oe,{sortCallback:ae,disableCheckbox:!0}),e(F,{get each(){return ne()},children:(r,s)=>{let t,h=(l().length>0?"/"+l().join("/"):"")+"/"+r.name;return r.is_dir||(t=k+"?inner="+K(h),o!==""&&(t=t+"&pass="+K(o)),$!==""&&(t=t+"&sign="+$)),e(Ue,{obj:r,get index(){return s()},jumpCallback:()=>j(l().concat(r.name)),innerPath:h,url:t,pass:o})}}),e(We,{})]}})}})}})]}}),e(H,{get when(){return R()!==""},get children(){return[e(we,{}),e(g,{w:"$full",pl:"$1",pr:"$1",get children(){return R()}})]}})]}})};export{tt as default};
