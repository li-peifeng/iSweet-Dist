import{cb as ee,aM as _,V as k,b as M,c7 as d,cc as w,e as te,h as e,aJ as A,be as f,cd as ne,ce as oe,cf as se,Y as P,a as re,k as ae,m as g,cg as ie,a$ as E,a7 as ce,bS as R,ax as le,bR as ue,S as h,I as O,b1 as B,a6 as ge,O as de,au as pe,C as F,bp as he,ch as me,aA as fe,ci as D,n as m,bf as we}from"./index.9e1720f6.js";import{F as be,c as Se,a as $e,S as ke}from"./SwitchColorMode.054f5229.js";import{s as _e,g as Ie,a as Ce}from"./webauthn-json.browser-ponyfill.1c672167.js";const ye="https://github.com/alist-org/alist";function ve(c){return ee(`${c}-${ye}`)}const xe=()=>{const c=_("sso_login_enabled"),I=k("sso_login_platform"),n=_("sso_compatibility_mode"),{searchParams:l,to:b}=M(),s=l.token;s!=null&&s!=""&&(d(s),b(decodeURIComponent(l.redirect||w||"/"),!0));function p(r){const o=r.data;o.token&&(d(o.token),b(decodeURIComponent(l.redirect||w||"/"),!0))}if(window.addEventListener("message",p),te(()=>{window.removeEventListener("message",p)}),c){const r=()=>{const u=f.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=u;return}window.open(u,"authPopup","width=500,height=600")};let o;switch(I){case"Github":o=Se;break;case"Microsoft":o=se;break;case"Google":o=oe;break;case"Dingtalk":o=ne;break;default:o=be}return e(A,{cursor:"pointer",boxSize:"$8",as:o,p:"$0_5",onclick:r})}},Oe=()=>{const c=k("logo").split(`
`),I=P(c[0],c.pop()),n=re(),l=ae(()=>`${k("site_title")}`);$e(l);const b=P("white","$neutral1"),[s,p]=g(localStorage.getItem("username")||""),[r,o]=g(localStorage.getItem("password")||""),[u,T]=g(""),[S,G]=g(!1),[$,N]=ie("remember-pwd","false"),[C,U]=g(!1),[j,J]=E(async()=>C()?f.post("/auth/login/ldap",{username:s(),password:r(),otp_code:u()}):f.post("/auth/login/hash",{username:s(),password:ve(r()),otp_code:u()})),[,V]=E((t,a,i)=>f.post("/authn/webauthn_finish_login?username="+i,JSON.stringify(a),{headers:{session:t}})),[,q]=E(t=>f.get("/authn/webauthn_begin_login?username="+t)),{searchParams:y,to:v}=M(),H=_("webauthn_login_enabled"),K=async()=>{G(!S())},x=async()=>{if(S()){if(!_e()){m.error(n("users.webauthn_not_supported"));return}d(),$()==="true"?localStorage.setItem("username",s()):localStorage.removeItem("username");const t=await q(s());we(t,async a=>{try{const i=Ie(a.options),Q=await Ce(i),X=await V(a.session,Q,s());D(X,Z=>{m.success(n("login.success")),d(Z.token),v(decodeURIComponent(y.redirect||w||"/"),!0)})}catch(i){i instanceof Error&&m.error(i.message)}})}else{$()==="true"?(localStorage.setItem("username",s()),localStorage.setItem("password",r())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const t=await J();D(t,a=>{m.success(n("login.success")),d(a.token),v(decodeURIComponent(y.redirect||w||"/"),!0)},(a,i)=>{!L()&&i===402?W(!0):m.error(a)})}},[L,W]=g(!1),z=_("ldap_login_enabled"),Y=k("ldap_login_tips");return z&&U(!0),e(fe,{zIndex:"1",w:"$full",h:"100vh",get children(){return e(ce,{get bgColor(){return b()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(R,{alignItems:"center",justifyContent:"space-around",get children(){return[e(le,{mr:"$2",boxSize:"$12",get src(){return I()}}),e(ue,{color:"$info9",fontSize:"$2xl",get children(){return l()}})]}}),e(h,{get when(){return!L()},get fallback(){return e(O,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return u()},onInput:t=>T(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&x()}})},get children(){return[e(O,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return s()},onInput:t=>p(t.currentTarget.value)}),e(h,{get when(){return!S()},get children(){return e(O,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return r()},onInput:t=>o(t.currentTarget.value),onKeyDown:t=>{t.key==="Enter"&&x()}})}}),e(R,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(B,{get checked(){return $()==="true"},onChange:()=>N($()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(ge,{color:"$success9",as:de,href:"https://peifeng.li/request-account-authorization",children:"\u83B7\u53D6\u8D26\u6237\u8BBF\u95EE\u6388\u6743"})]}})]}}),e(pe,{w:"$full",spacing:"$2",get children(){return[e(h,{get when(){return!S()},get children(){return[e(F,{w:"$full",colorScheme:"danger",onClick:()=>{d(),v(decodeURIComponent(y.redirect||w||"/"),!0)},get children(){return n("login.use_guest")}}),e(F,{colorScheme:"warning",w:"$full",onClick:()=>{L()?T(""):(p(""),o(""))},get children(){return n("login.clear")}})]}}),e(F,{colorScheme:"success",w:"$full",get loading(){return j()},onClick:x,get children(){return n("login.login")}})]}}),e(h,{when:z,get children(){return e(B,{w:"$full",get checked(){return C()===!0},onChange:()=>U(!C()),children:Y})}}),e(R,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(he,{}),e(ke,{}),e(xe,{}),e(h,{when:H,get children(){return e(A,{cursor:"pointer",boxSize:"$8",as:me,p:"$0_5",onclick:K})}})]}})]}})}})};export{Oe as default};
